services:
  ntrip-caster:
    build: ./ntrip-caster
    # image: polaris/ntrip-caster:latest  # FOR FINAL DELIVERABLE
    container_name: ntrip-caster
    volumes:
      - ./shared:/home/ntrip-caster
      - ../common:/common
    devices:
      - "/dev/ttyACM0:/dev/ttyACM0"  # GNSS Receiver, may need to change based on your device
    ports:
      - "2101:2101" # NTRIP
    restart: unless-stopped
  enrollment-client:
    build: ../common/enrollment-client
    # image: polaris/enrollment-client:latest  # FOR FINAL DELIVERABLE
    container_name: enrollment-client
    environment: 
      - LIGHTHOUSE_GROUP_NAME=base_station
      - LIGHTHOUSE_PUBLIC_IP=${LIGHTHOUSE_PUBLIC_IP}
      - LIGHTHOUSE_NETWORK_KEY=${LIGHTHOUSE_NETWORK_KEY}
    volumes:
      - ./shared:/home/enrollment-client/shared
    ports:
      - "80:80"   # HTTP
      - "443:443" # HTTPS
    restart: unless-stopped
  nebula:
    image: nebulaoss/nebula:latest
    container_name: nebula
    network_mode: "host"
    cap_add:
      - NET_ADMIN
    volumes:
      - ./shared:/config
    depends_on:
      - enrollment-client
    restart: unless-stopped